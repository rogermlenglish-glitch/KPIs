<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KPIs Moviles Serenazgo - Julio 2025</title>
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Fuentes -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <!-- SheetJS (XLSX) -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    :root {
      --bg: #0b1221;
      --card: #101a33;
      --card2: #0f1730;
      --muted: #8da2c0;
      --primary: #4f8cff;
      --accent: #22d3ee;
      --text: #e6eefc;
      --badges: #1f2b4a;
    }
    html, body {
      background: linear-gradient(180deg, #0a1020 0%, #0b1221 100%);
      color: var(--text);
      font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .glass {
      background: linear-gradient(180deg, var(--card) 0%, var(--card2) 100%);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.04);
    }
    .kpi {
      background: linear-gradient(180deg, #0f1834 0%, #0c152e 100%);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 16px;
      padding: 16px;
    }
    .chip {
      background: var(--badges);
      color: var(--text);
      border: 1px solid rgba(255,255,255,0.08);
      padding: 4px 10px;
      border-radius: 9999px;
      font-size: 12px;
      white-space: nowrap;
    }
    .btn {
      background: var(--primary);
      color: white;
      border-radius: 12px;
      padding: 10px 14px;
      font-weight: 600;
      transition: transform .05s ease;
    }
    .btn:active { transform: translateY(1px); }
    .btn-secondary {
      background: #182241;
    }
    table {
      border-collapse: separate;
      border-spacing: 0;
      width: 100%;
    }
    thead th {
      position: sticky; top: 0;
      background: #0e1832;
      z-index: 1;
    }
    th, td {
      padding: 10px 12px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      font-size: 14px;
    }
    tr:hover td {
      background: rgba(255,255,255,0.02);
    }
    .scroll-shadow {
      mask-image: linear-gradient(to bottom, transparent 0, black 28px, black calc(100% - 28px), transparent 100%);
      -webkit-mask-image: linear-gradient(to bottom, transparent 0, black 28px, black calc(100% - 28px), transparent 100%);
    }
    .card-title {
      font-weight: 700;
      letter-spacing: .3px;
    }
    .subtle {
      color: var(--muted);
    }
    .input {
      background: #121b36;
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 12px;
      color: var(--text);
      padding: 10px 12px;
      outline: none;
      width: 100%;
    }
    .checklist {
      max-height: 220px;
      overflow: auto;
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 12px;
      padding: 8px;
      background: #0f1730;
    }
    .grid-auto {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 14px;
    }
    .section-title {
      font-weight: 800;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <header class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-8 pb-4">
    <div class="flex items-center justify-between gap-4">
      <div>
        <h1 class="text-2xl sm:text-3xl font-extrabold tracking-tight">KPIs de Movilidad – Serenazgo</h1>
        <p class="subtle mt-1">Filtros por fecha, conductores y vehículos (Camionetas & Motocicletas). Vista para PC y móviles.</p>
      </div>
      <div class="flex items-center gap-2">
        <label class="btn btn-secondary cursor-pointer">
          <input id="fileInput" type="file" accept=".xlsx,.xls" class="hidden" />
          Cargar Excel
        </label>
        <button id="reloadBtn" class="btn btn-secondary">Intentar cargar <span class="font-bold">data.xlsx</span></button>
        <button id="resetBtn" class="btn">Limpiar filtros</button>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-24">
    <!-- Filtros -->
    <section class="glass p-4 sm:p-6">
      <div class="flex items-center justify-between flex-wrap gap-2">
        <div class="flex items-center gap-2">
          <span class="chip">EUG 707, EUG 717 → Camionetas</span>
          <span class="chip">EX 7680, EX 7664 → Motocicletas</span>
        </div>
        <div class="subtle text-sm">Puedes subir tu archivo o coloca <b>data.xlsx</b> junto a este HTML</div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-12 gap-4 mt-4">
        <!-- Fechas -->
        <div class="lg:col-span-3 glass p-4">
          <div class="section-title mb-3">Fecha</div>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <div>
              <label class="subtle text-sm">Desde</label>
              <input id="fromDate" type="date" class="input mt-1" />
            </div>
            <div>
              <label class="subtle text-sm">Hasta</label>
              <input id="toDate" type="date" class="input mt-1" />
            </div>
          </div>
        </div>

        <!-- Conductores -->
        <div class="lg:col-span-4 glass p-4">
          <div class="flex items-center justify-between">
            <div class="section-title mb-3">Conductores</div>
            <div class="flex gap-2">
              <button id="driversAll" class="chip hover:opacity-80">Todos</button>
              <button id="driversNone" class="chip hover:opacity-80">Ninguno</button>
            </div>
          </div>
          <div id="driversList" class="checklist grid-auto"></div>
        </div>

        <!-- Vehículos -->
        <div class="lg:col-span-5 glass p-4">
          <div class="flex items-center justify-between">
            <div class="section-title mb-3">Vehículos</div>
            <div class="flex gap-2">
              <button id="vehAll" class="chip hover:opacity-80">Todos</button>
              <button id="vehNone" class="chip hover:opacity-80">Ninguno</button>
            </div>
          </div>

          <!-- Grupos -->
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-3">
            <label class="flex items-center gap-2">
              <input id="grpCam" type="checkbox" class="accent-sky-400" checked>
              Seleccionar Camionetas (EUG 707, EUG 717)
            </label>
            <label class="flex items-center gap-2">
              <input id="grpMoto" type="checkbox" class="accent-sky-400" checked>
              Seleccionar Motocicletas (EX 7680, EX 7664)
            </label>
          </div>

          <div id="vehList" class="checklist grid-auto"></div>
        </div>
      </div>
    </section>

    <!-- KPIs -->
    <section class="grid grid-cols-1 sm:grid-cols-3 gap-4 mt-6">
      <div class="kpi">
        <div class="subtle text-sm">Galones totales</div>
        <div id="kpiGalTotal" class="text-3xl font-extrabold mt-1">—</div>
        <div id="kpiGalTotalNote" class="subtle text-xs mt-1">Según filtros</div>
      </div>
      <div class="kpi">
        <div class="subtle text-sm">Galones promedio</div>
        <div id="kpiGalAvg" class="text-3xl font-extrabold mt-1">—</div>
        <div class="subtle text-xs mt-1">Promedio por registro filtrado</div>
      </div>
      <div class="kpi">
        <div class="subtle text-sm">Kilómetros promedio</div>
        <div id="kpiKmAvg" class="text-3xl font-extrabold mt-1">—</div>
        <div class="subtle text-xs mt-1">Promedio por registro filtrado</div>
      </div>
    </section>

    <!-- Charts -->
    <section class="grid grid-cols-1 lg:grid-cols-2 gap-4 mt-6">
      <div class="glass p-4">
        <div class="card-title mb-2">Kilómetros por vehículo</div>
        <canvas id="kmChart" height="220"></canvas>
      </div>
      <div class="glass p-4">
        <div class="card-title mb-2">Galones por vehículo</div>
        <canvas id="galChart" height="220"></canvas>
      </div>
    </section>

    <!-- Tabla -->
    <section class="glass p-4 sm:p-6 mt-6">
      <div class="flex items-center justify-between gap-2 flex-wrap">
        <div class="card-title">Tabla de datos (según filtros)</div>
        <div class="flex gap-2">
          <button id="exportBtn" class="btn btn-secondary">Exportar CSV</button>
          <span id="rowCount" class="chip">0 filas</span>
        </div>
      </div>
      <div class="mt-3 scroll-shadow" style="max-height: 60vh; overflow:auto;">
        <table id="dataTable">
          <thead></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </main>

  <script>
    // === Configuración de tipos para las placas mencionadas ===
    const VEHICLE_TYPES = {
      "EUG 707": "Camioneta",
      "EUG 717": "Camioneta",
      "EX 7680": "Motocicleta",
      "EX 7664": "Motocicleta",
    };

    // === Estado global ===
    let rawRows = [];        // registros originales
    let headers = [];        // nombres de columnas
    let colIdx = {};         // índice de columnas detectadas
    let filtered = [];       // registros después de filtros
    let kmChart, galChart;   // referencias Chart.js

    // === Utilidades ===
    const norm = (s) => (s ?? "").toString().trim();
    const parseNum = (v) => {
      if (v === null || v === undefined) return NaN;
      // reemplazar coma decimal por punto
      const s = norm(v).replace(/\./g, "").replace(",", ".");
      const n = parseFloat(s);
      return isNaN(n) ? parseFloat(norm(v)) : n;
    };
    const parseDate = (v) => {
      // detecta Excel dates (número) o string
      if (typeof v === "number") {
        // Excel serial date
        const d = XLSX.SSF.parse_date_code(v);
        return new Date(Date.UTC(d.y, d.m - 1, d.d));
      }
      const s = norm(v);
      if (!s) return null;
      // soporta dd/mm/yyyy, yyyy-mm-dd, etc.
      const partsSlash = s.match(/^(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2,4})$/);
      if (partsSlash) {
        const dd = +partsSlash[1], mm = +partsSlash[2], yy = +partsSlash[3];
        const year = yy < 100 ? 2000 + yy : yy;
        return new Date(year, mm - 1, dd);
      }
      const tryD = new Date(s);
      return isNaN(tryD.getTime()) ? null : tryD;
    };

    function detectColumns(headerRow) {
      // busca columnas por nombre probable
      const h = headerRow.map(x => norm(x).toLowerCase());
      const idx = (kw) => h.findIndex(col => col.includes(kw));

      const dateIdx = [ "fecha", "f. ", "día", "dia" ]
        .map(kw => h.findIndex(col => col.includes(kw)))
        .find(i => i >= 0);

      const driverIdx = ["conductor", "chofer", "piloto"]
        .map(kw => idx(kw)).find(i => i >= 0);

      const plateIdx = ["placa", "vehiculo", "vehículo", "unidad", "movil", "móvil"]
        .map(kw => idx(kw)).find(i => i >= 0);

      const kmIdx = ["kilometro", "kilómetro", "kilometraje", "km"]
        .map(kw => idx(kw)).find(i => i >= 0);

      const galIdx = ["galon", "galón", "galones", "combustible", "gasolina", "diesel", "diésel"]
        .map(kw => idx(kw)).find(i => i >= 0);

      return {
        date: dateIdx ?? -1,
        driver: driverIdx ?? -1,
        plate: plateIdx ?? -1,
        km: kmIdx ?? -1,
        gal: galIdx ?? -1,
      };
    }

    function formatNum(n, digits = 2) {
      if (n === null || n === undefined || isNaN(n)) return "—";
      return n.toLocaleString("es-PE", { maximumFractionDigits: digits, minimumFractionDigits: digits });
    }

    function formatInt(n) {
      if (n === null || n === undefined || isNaN(n)) return "—";
      return Math.round(n).toLocaleString("es-PE");
    }

    // === Carga de Excel ===
    async function loadFromUrl(url = "data.xlsx") {
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error("No se encontró data.xlsx");
        const arrayBuf = await res.arrayBuffer();
        processWorkbook(arrayBuf);
      } catch (e) {
        alert("No se pudo cargar 'data.xlsx'. Puedes usar el botón 'Cargar Excel'.");
        console.warn(e);
      }
    }

    function processWorkbook(arrayBuf) {
      const wb = XLSX.read(arrayBuf, { type: "array" });
      const ws = wb.Sheets[wb.SheetNames[0]];
      const json = XLSX.utils.sheet_to_json(ws, { header: 1, raw: true, defval: "" });

      if (!json || json.length === 0) {
        alert("El archivo está vacío.");
        return;
      }

      headers = json[0].map(h => norm(h));
      colIdx = detectColumns(headers);

      rawRows = json.slice(1).filter(r => r.some(x => norm(x) !== ""));
      buildDynamicUI();
      applyFilters(); // primera vez
    }

    // === UI dinámica ===
    function buildDynamicUI() {
      // Conductores
      const driverSet = new Set();
      rawRows.forEach(r => {
        const v = colIdx.driver >= 0 ? norm(r[colIdx.driver]) : "";
        if (v) driverSet.add(v);
      });
      const drivers = Array.from(driverSet).sort((a, b) => a.localeCompare(b, "es"));

      const driversList = document.getElementById("driversList");
      driversList.innerHTML = drivers.map(d => `
        <label class="flex items-center gap-2 p-2 rounded hover:bg-[rgba(255,255,255,0.03)]">
          <input type="checkbox" class="driverCheck accent-sky-400" data-val="${d.replace(/"/g,'&quot;')}" checked />
          <span>${d}</span>
        </label>
      `).join("");

      // Vehículos
      const plateSet = new Set();
      rawRows.forEach(r => {
        const v = colIdx.plate >= 0 ? norm(r[colIdx.plate]) : "";
        if (v) plateSet.add(v);
      });
      const plates = Array.from(plateSet).sort((a, b) => a.localeCompare(b, "es"));

      const vehList = document.getElementById("vehList");
      vehList.innerHTML = plates.map(placa => {
        const tipo = VEHICLE_TYPES[placa] ?? "—";
        return `
          <label class="flex items-center gap-2 p-2 rounded hover:bg-[rgba(255,255,255,0.03)]">
            <input type="checkbox" class="vehCheck accent-sky-400" data-val="${placa.replace(/"/g,'&quot;')}" checked />
            <span class="flex items-center gap-2">
              <span class="font-medium">${placa}</span>
              <span class="chip">${tipo}</span>
            </span>
          </label>
        `;
      }).join("");

      // Eventos
      document.querySelectorAll(".driverCheck").forEach(el => el.addEventListener("change", applyFilters));
      document.querySelectorAll(".vehCheck").forEach(el => el.addEventListener("change", applyFilters));

      document.getElementById("driversAll").onclick = () => {
        document.querySelectorAll(".driverCheck").forEach(el => el.checked = true);
        applyFilters();
      };
      document.getElementById("driversNone").onclick = () => {
        document.querySelectorAll(".driverCheck").forEach(el => el.checked = false);
        applyFilters();
      };
      document.getElementById("vehAll").onclick = () => {
        document.querySelectorAll(".vehCheck").forEach(el => el.checked = true);
        document.getElementById("grpCam").checked = true;
        document.getElementById("grpMoto").checked = true;
        applyFilters();
      };
      document.getElementById("vehNone").onclick = () => {
        document.querySelectorAll(".vehCheck").forEach(el => el.checked = false);
        document.getElementById("grpCam").checked = false;
        document.getElementById("grpMoto").checked = false;
        applyFilters();
      };

      document.getElementById("fromDate").addEventListener("change", applyFilters);
      document.getElementById("toDate").addEventListener("change", applyFilters);

      // Grupos de vehículos (Camionetas / Motocicletas)
      document.getElementById("grpCam").addEventListener("change", (e) => {
        const platesCam = ["EUG 707", "EUG 717"];
        document.querySelectorAll(".vehCheck").forEach(el => {
          const val = el.getAttribute("data-val");
          if (platesCam.includes(val)) el.checked = e.target.checked;
        });
        applyFilters();
      });
      document.getElementById("grpMoto").addEventListener("change", (e) => {
        const platesMoto = ["EX 7680", "EX 7664"];
        document.querySelectorAll(".vehCheck").forEach(el => {
          const val = el.getAttribute("data-val");
          if (platesMoto.includes(val)) el.checked = e.target.checked;
        });
        applyFilters();
      });

      // Tabla: cabeceras (agrega columna Tipo)
      const thead = document.querySelector("#dataTable thead");
      thead.innerHTML = `
        <tr>
          ${headers.map(h => `<th class="text-left">${h}</th>`).join("")}
          <th class="text-left">Tipo</th>
        </tr>
      `;
    }

    function getActiveFilters() {
      const from = document.getElementById("fromDate").value ? new Date(document.getElementById("fromDate").value) : null;
      const to = document.getElementById("toDate").value ? new Date(document.getElementById("toDate").value) : null;

      const selectedDrivers = new Set(
        Array.from(document.querySelectorAll(".driverCheck"))
          .filter(el => el.checked)
          .map(el => el.getAttribute("data-val"))
      );

      const selectedVeh = new Set(
        Array.from(document.querySelectorAll(".vehCheck"))
          .filter(el => el.checked)
          .map(el => el.getAttribute("data-val"))
      );

      return { from, to, selectedDrivers, selectedVeh };
    }

    function applyFilters() {
      if (!rawRows.length) return;

      const { from, to, selectedDrivers, selectedVeh } = getActiveFilters();

      filtered = rawRows.filter(r => {
        // fecha
        let okDate = true;
        if (colIdx.date >= 0) {
          const d = parseDate(r[colIdx.date]);
          if (from && d && d < new Date(from.getFullYear(), from.getMonth(), from.getDate())) okDate = false;
          if (to && d && d > new Date(to.getFullYear(), to.getMonth(), to.getDate(), 23, 59, 59)) okDate = false;
        }
        // conductor
        let okDriver = true;
        if (colIdx.driver >= 0 && selectedDrivers.size > 0) {
          const drv = norm(r[colIdx.driver]);
          okDriver = selectedDrivers.has(drv);
        }
        // vehículo
        let okVeh = true;
        if (colIdx.plate >= 0 && selectedVeh.size > 0) {
          const plc = norm(r[colIdx.plate]);
          okVeh = selectedVeh.has(plc);
        }
        return okDate && okDriver && okVeh;
      });

      updateKPIs();
      renderTable();
      updateCharts();
    }

    function sum(arr) { return arr.reduce((a, b) => a + (parseFloat(b) || 0), 0); }
    function avg(arr) { return arr.length ? sum(arr) / arr.length : NaN; }

    function updateKPIs() {
      const galVals = filtered.map(r => colIdx.gal >= 0 ? parseNum(r[colIdx.gal]) : NaN).filter(v => !isNaN(v));
      const kmVals  = filtered.map(r => colIdx.km  >= 0 ? parseNum(r[colIdx.km])  : NaN).filter(v => !isNaN(v));

      document.getElementById("kpiGalTotal").textContent = formatNum(sum(galVals), 2);
      document.getElementById("kpiGalAvg").textContent   = formatNum(avg(galVals), 2);
      document.getElementById("kpiKmAvg").textContent    = formatNum(avg(kmVals), 2);

      const note = filtered.length === rawRows.length ? "Sin filtros" : "Según filtros";
      document.getElementById("kpiGalTotalNote").textContent = note;
    }

    function renderTable() {
      const tbody = document.querySelector("#dataTable tbody");
      const rowsHtml = filtered.map(r => {
        const placa = colIdx.plate >= 0 ? norm(r[colIdx.plate]) : "";
        const tipo = VEHICLE_TYPES[placa] ?? "—";
        return `
          <tr>
            ${headers.map((_, i) => `<td>${r[i] ?? ""}</td>`).join("")}
            <td>${tipo}</td>
          </tr>
        `;
      }).join("");
      tbody.innerHTML = rowsHtml || `<tr><td class="subtle p-4" colspan="${headers.length+1}">Sin datos para los filtros seleccionados.</td></tr>`;
      document.getElementById("rowCount").textContent = `${filtered.length.toLocaleString("es-PE")} fila(s)`;
    }

    function groupByPlate(valuesIdx) {
      const map = new Map(); // placa -> suma
      filtered.forEach(r => {
        const placa = colIdx.plate >= 0 ? norm(r[colIdx.plate]) : "(Sin placa)";
        const v = parseNum(r[valuesIdx]);
        if (!isNaN(v)) {
          map.set(placa, (map.get(placa) || 0) + v);
        }
      });
      // ordenar por valor desc
      const sorted = Array.from(map.entries()).sort((a, b) => b[1] - a[1]);
      // limitar a top 12 para claridad
      return sorted.slice(0, 12);
    }

    function ensureChart(ctxId, data, label, unit, prevRef) {
      const ctx = document.getElementById(ctxId).getContext("2d");
      if (prevRef) prevRef.destroy();
      return new Chart(ctx, {
        type: 'bar',
        data: {
          labels: data.map(d => d[0]),
          datasets: [{
            label: `${label}`,
            data: data.map(d => d[1]),
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: true, labels: { color: '#cfd9f7' } },
            tooltip: { callbacks: { label: (ctx) => `${ctx.dataset.label}: ${formatNum(ctx.parsed.y)} ${unit}` } }
          },
          scales: {
            x: { ticks: { color: '#cfd9f7' }, grid: { color: 'rgba(255,255,255,0.06)' } },
            y: { ticks: { color: '#cfd9f7' }, grid: { color: 'rgba(255,255,255,0.06)' } }
          }
        }
      });
    }

    function updateCharts() {
      // KM por placa
      if (colIdx.km >= 0 && colIdx.plate >= 0) {
        const dataKm = groupByPlate(colIdx.km);
        kmChart = ensureChart("kmChart", dataKm, "Kilómetros", "km", kmChart);
      }
      // Galones por placa
      if (colIdx.gal >= 0 && colIdx.plate >= 0) {
        const dataGal = groupByPlate(colIdx.gal);
        galChart = ensureChart("galChart", dataGal, "Galones", "gal", galChart);
      }
    }

    // === Exportar CSV (filtrado) ===
    function exportCSV() {
      // añade columna Tipo
      const out = [ [...headers, "Tipo"] ];
      filtered.forEach(r => {
        const placa = colIdx.plate >= 0 ? norm(r[colIdx.plate]) : "";
        const tipo = VEHICLE_TYPES[placa] ?? "";
        out.push([ ...headers.map((_, i) => r[i] ?? ""), tipo ]);
      });
      const ws = XLSX.utils.aoa_to_sheet(out);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Datos");
      XLSX.writeFile(wb, "datos_filtrados.csv", { bookType: "csv" });
    }

    // === Eventos de UI general ===
    document.getElementById("fileInput").addEventListener("change", (ev) => {
      const file = ev.target.files?.[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (e) => processWorkbook(e.target.result);
      reader.readAsArrayBuffer(file);
    });
    document.getElementById("reloadBtn").addEventListener("click", () => loadFromUrl("data.xlsx"));
    document.getElementById("resetBtn").addEventListener("click", () => {
      // reset fecha
      document.getElementById("fromDate").value = "";
      document.getElementById("toDate").value = "";
      // reset checks
      document.querySelectorAll(".driverCheck,.vehCheck").forEach(el => el.checked = true);
      const grpCam = document.getElementById("grpCam");
      const grpMoto = document.getElementById("grpMoto");
      if (grpCam) grpCam.checked = true;
      if (grpMoto) grpMoto.checked = true;
      applyFilters();
    });
    document.getElementById("exportBtn").addEventListener("click", exportCSV);

    // === Inicio: intentar cargar data.xlsx automáticamente ===
    window.addEventListener("DOMContentLoaded", () => loadFromUrl("data.xlsx"));
  </script>
</body>
</html>
